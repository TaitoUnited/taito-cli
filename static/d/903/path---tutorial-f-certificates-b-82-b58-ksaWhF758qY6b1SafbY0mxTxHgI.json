{"data":{"tutorial":{"id":"48a7350b-c188-5631-9207-9ff5e68afb7e","html":"<h2>APPENDIX F: SSL/TLS certificates</h2>\n<p>Production environment uses a domain validated SSL/TLS certificate by default. It was acquired from Let's Encrypt when you deployed your application to the production environment the first time, and it will be renewed automatically every 3 months.</p>\n<p>A domain validated (DV) certificate does not provide identity assurance and therefore it is not recommended for e-Commerce or online financial transactions. In addition, sites with an organization validated (OV) or an extended validation (EV) certificate may seem more trustworthy in the eyes of some users. Most users won't notice any difference if an OV certificate is used instead of a DV certificate. However, if an EV certificate is being used, the organization name and country are shown clearly on the address bar of the browser. Therefore many large organizations use EV certificates on their sites even though they are pricey and require extra effort.</p>\n<h4>1. Create a certificate signing request (csr) and send it to CA</h4>\n<p>Add <code class=\"language-text\">tls.key:csrkey</code> secret for the production domain name in <code class=\"language-text\">taito-config.sh</code> file.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># OV certificate for production only</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">${taito_env}</span>\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"prod\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  taito_secrets<span class=\"token operator\">=</span><span class=\"token string\">\"\n    <span class=\"token variable\">${taito_secrets}</span>\n    myapp-mydomain-com-1.tls.key:csrkey\n  \"</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<blockquote>\n<p>The <code class=\"language-text\">-1</code> suffix is a counter that can be used later to create a new secret if a new csr needs to be generated while the old certificate is still in use in production.</p>\n</blockquote>\n<p>Create a private key and a certificate signing request with the following command. The private key will be stored to Kubernetes and the certificate signing request will be saved to your local disk.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">taito <span class=\"token function\">env</span> rotate:prod myapp-mydomain-com-1.tls.key</code></pre></div>\n<p>Send the <code class=\"language-text\">.csr</code> file to the Certificate Authority.</p>\n<blockquote>\n<p>TODO If someone just gave you the private key, you can store it by...</p>\n</blockquote>\n<blockquote>\n<p>TODO wildcard certificate naming --> x-myapp-comain-com</p>\n</blockquote>\n<h4>2. Create a chained certificate file</h4>\n<p>You get a bunch of certificate files from the Certificate Authority. You should combine them in a correct order to get a chained certificate file that contains all of them. Some examples:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">cat</span> app_mydomain_com.crt TrustedSecureCertificateAuthority5.crt USERTrustRSAAddTrustCA.crt AddTrustExternalCARoot.crt <span class=\"token operator\">></span> app_mydomain_com-chained.crt</code></pre></div>\n<p><a href=\"https://medium.com/two-cents/certificate-chain-example-e37d68c3a3f0\">https://medium.com/two-cents/certificate-chain-example-e37d68c3a3f0</a></p>\n<h4>3. Save the chained certificate file to Kubernetes</h4>\n<p>Add <code class=\"language-text\">tls.crt:file</code> secret for the production domain name in <code class=\"language-text\">taito-config.sh</code> file.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># Custom certificate for production</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">${taito_env}</span>\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"prod\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  taito_secrets<span class=\"token operator\">=</span><span class=\"token string\">\"\n    <span class=\"token variable\">${taito_secrets}</span>\n    myapp-mydomain-com-1.tls.key:csrkey\n    myapp-mydomain-com-1.tls.crt:file\n  \"</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<p>Save the chained crt file to Kubernetes:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">taito <span class=\"token function\">env</span> rotate:prod myapp-mydomain-com-1.tls.crt</code></pre></div>\n<h4>4. Take the new certificate into use</h4>\n<p>Define <code class=\"language-text\">myapp-mydomain-com-1</code> secret for the production domain name in <code class=\"language-text\">helm-prod.yaml</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">acme-myapp:\n  ingress:\n    domains:\n      - name: <span class=\"token variable\">${taito_domain}</span>\n        certSecret: myapp-mydomain-com-1</code></pre></div>\n<p>Either merge the change to master branch with <code class=\"language-text\">taito env merge:dev prod</code>, or deploy the configuration change directly to production:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">taito deployment deploy:prod</code></pre></div>\n<h4>5. Renew the certificate</h4>\n<p>TODO</p>\n<h4>6. Revert back to the default DV certificate</h4>\n<p>You can revert back to the default DV certificate just by removing the <code class=\"language-text\">certSecret</code> setting for the domain from <code class=\"language-text\">helm-prod.yaml</code>.</p>"},"menu":{"edges":[{"node":{"id":"9162b0dd-c4f6-5ba0-988b-4c795a6ce66f","headings":[{"value":"1. Starting a new project"}],"fields":{"slug":"/tutorial/01-starting-a-new-project/"}}},{"node":{"id":"64c9ed3b-6893-5927-9d97-72bd14b54630","headings":[{"value":"2. Local development"}],"fields":{"slug":"/tutorial/02-local-development/"}}},{"node":{"id":"3827531b-fba0-5a2a-9084-52516d3872f3","headings":[{"value":"3. Version control"}],"fields":{"slug":"/tutorial/03-version-control/"}}},{"node":{"id":"b2030e15-dc9b-5f98-a5cf-3e3dccdd6c11","headings":[{"value":"4. Project management"}],"fields":{"slug":"/tutorial/04-project-management/"}}},{"node":{"id":"d83c3a19-3868-56cf-a5f9-b24b2af66b20","headings":[{"value":"5. Remote environments"}],"fields":{"slug":"/tutorial/05-remote-environments/"}}},{"node":{"id":"a3492616-cb8e-5f4a-b062-48d6537274e7","headings":[{"value":"6. Environment variables and secrets"}],"fields":{"slug":"/tutorial/06-env-variables-and-secrets/"}}},{"node":{"id":"121a9436-85c8-5b92-878e-f735f1eb93ff","headings":[{"value":"7. Databases and files"}],"fields":{"slug":"/tutorial/07-databases-and-files/"}}},{"node":{"id":"e748c043-1f1c-5518-80dd-80b011007d72","headings":[{"value":"8. Cloud services and Terraform"}],"fields":{"slug":"/tutorial/08-cloud-services-and-terraform/"}}},{"node":{"id":"29e65915-3efc-5834-94b8-14d162cd137f","headings":[{"value":"9. full-stack-template specific details"}],"fields":{"slug":"/tutorial/09-full-stack-template-specific/"}}},{"node":{"id":"18fc3997-3a39-5864-a5bf-e48ffc85bbfa","headings":[{"value":"10. Production setup"}],"fields":{"slug":"/tutorial/10-production-setup/"}}},{"node":{"id":"5accd1d7-2b43-5201-b38b-3aadfc1bcc78","headings":[{"value":"11. Running in production"}],"fields":{"slug":"/tutorial/11-running-in-production/"}}},{"node":{"id":"6609bb19-ef32-58a4-ad47-c9a560afa413","headings":[{"value":"12. Creating a custom command"}],"fields":{"slug":"/tutorial/12-creating-a-custom-command/"}}},{"node":{"id":"ed727541-68ed-5ffa-b500-3e2d67ee0aad","headings":[{"value":"13. Creating a custom plugin"}],"fields":{"slug":"/tutorial/13-creating-a-custom-plugin/"}}},{"node":{"id":"7c5da057-3c39-5275-b002-665f09bf652d","headings":[{"value":"14. Creating a custom template"}],"fields":{"slug":"/tutorial/14-creating-a-custom-template/"}}},{"node":{"id":"ac758a21-5898-581f-8f8a-89a8edfd94d1","headings":[{"value":"15. Creating a zone"}],"fields":{"slug":"/tutorial/15-creating-a-zone/"}}},{"node":{"id":"c697982a-07ef-554a-a3a3-041864902c34","headings":[{"value":"16. Zone maintenance"}],"fields":{"slug":"/tutorial/16-zone-maintenance/"}}},{"node":{"id":"cc1283ed-9c5b-54f3-9e58-066d00429a8e","headings":[{"value":"17. Zone monitoring"}],"fields":{"slug":"/tutorial/17-zone-monitoring/"}}},{"node":{"id":"d96b1123-f8bd-5207-864f-abc448c8a034","headings":[{"value":"18. Zone recovery"}],"fields":{"slug":"/tutorial/18-zone-recovery/"}}},{"node":{"id":"1e016b44-8bf7-5291-8a77-e33be39d3787","headings":[{"value":"APPENDIX A: Technology tutorials"}],"fields":{"slug":"/tutorial/a-technology-tutorials/"}}},{"node":{"id":"669a57d7-a9e4-5d0e-8f6b-be481ca4be38","headings":[{"value":"APPENDIX B: Software design"}],"fields":{"slug":"/tutorial/b-software-design/"}}},{"node":{"id":"97b359bc-af92-5837-937e-646a7c1751a6","headings":[{"value":"APPENDIX C: Modern server infrastructure"}],"fields":{"slug":"/tutorial/c-modern-server-infrastructure/"}}},{"node":{"id":"b6b33ce2-199f-5fce-b0a9-28f0fd30e0f9","headings":[{"value":"APPENDIX D: Security"}],"fields":{"slug":"/tutorial/d-security/"}}},{"node":{"id":"143d54e6-a662-5fe2-9b4d-5b3d8b7d8786","headings":[],"fields":{"slug":"/tutorial/e-data-protection-and-privacy/"}}},{"node":{"id":"48a7350b-c188-5631-9207-9ff5e68afb7e","headings":[{"value":"APPENDIX F: SSL/TLS certificates"}],"fields":{"slug":"/tutorial/f-certificates/"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"48a7350b-c188-5631-9207-9ff5e68afb7e"}}