{"data":{"tutorial":{"id":"89504f6e-33ec-5677-82b5-9fa28736b161","html":"<h2 id=\"10-production-setup\"><a href=\"#10-production-setup\" aria-label=\"10 production setup permalink\" class=\"autolink-a\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10. Production setup</h2>\n<h3 id=\"101-was-automatically-set\"><a href=\"#101-was-automatically-set\" aria-label=\"101 was automatically set permalink\" class=\"autolink-a\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10.1. Was automatically set</h3>\n<p>These were already automatically set during <code class=\"language-text\">taito project apply</code> and <code class=\"language-text\">taito env apply:prod</code>:</p>\n<ul>\n<li>Backups: TODO open backups</li>\n<li>Log monitoring: <code class=\"language-text\">taito open logs:prod</code> and TODO open alerts</li>\n<li>Error tracking: <code class=\"language-text\">taito open errors:prod</code></li>\n<li>Uptime monitoring: <code class=\"language-text\">taito open uptime:prod</code></li>\n<li>Resource limits and autoscaling: <code class=\"language-text\">taito status:prod</code> (TODO show more info)</li>\n</ul>\n<h3 id=\"102-performance-testing\"><a href=\"#102-performance-testing\" aria-label=\"102 performance testing permalink\" class=\"autolink-a\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10.2. Performance testing</h3>\n<p>TODO</p>\n<h3 id=\"103-security-audit\"><a href=\"#103-security-audit\" aria-label=\"103 security audit permalink\" class=\"autolink-a\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10.3. Security audit</h3>\n<p>TODO</p>\n<h3 id=\"104-custom-ssltls-certificate\"><a href=\"#104-custom-ssltls-certificate\" aria-label=\"104 custom ssltls certificate permalink\" class=\"autolink-a\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10.4. Custom SSL/TLS certificate</h3>\n<p>Production environment uses a domain validated SSL/TLS certificate by default. It was acquired from Let's Encrypt when you deployed your application to the production environment the first time, and it will be renewed automatically every 3 months.</p>\n<p>A domain validated (DV) certificate does not provide identity assurance and therefore it is not recommended for e-Commerce or online financial transactions. In addition, sites with an organization validated (OV) or an extended validation (EV) certificate may seem more trustworthy in the eyes of some users. Most users won't notice any difference if an OV certificate is used instead of a DV certificate. However, if an EV certificate is being used, the organization name and country are shown clearly on the address bar of the browser. Therefore many large organizations use EV certificates on their sites even though they are pricey and require extra effort.</p>\n<h4 id=\"1041-create-a-certificate-signing-request-csr-and-send-it-to-ca\"><a href=\"#1041-create-a-certificate-signing-request-csr-and-send-it-to-ca\" aria-label=\"1041 create a certificate signing request csr and send it to ca permalink\" class=\"autolink-a\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10.4.1. Create a certificate signing request (csr) and send it to CA</h4>\n<p>Add <code class=\"language-text\">tls.key:csrkey</code> secret for the production domain name in <code class=\"language-text\">taito-config.sh</code> file.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># OV certificate for production only</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">${taito_env}</span>\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"prod\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  taito_secrets<span class=\"token operator\">=</span><span class=\"token string\">\"\n    <span class=\"token variable\">${taito_secrets}</span>\n    myapp-mydomain-com-1.tls.key:csrkey\n  \"</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<blockquote>\n<p>The <code class=\"language-text\">-1</code> suffix is a counter that can be used later to create a new secret if a new csr needs to be generated while the old certificate is still in use in production.</p>\n</blockquote>\n<p>Create a private key and a certificate signing request with the following command. The private key will be stored to Kubernetes and the certificate signing request will be saved to your local disk.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">taito <span class=\"token function\">env</span> rotate:prod myapp-mydomain-com-1.tls.key</code></pre></div>\n<p>Send the <code class=\"language-text\">.csr</code> file to the Certificate Authority.</p>\n<blockquote>\n<p>TODO If someone just gave you the private key, you can store it by...</p>\n</blockquote>\n<blockquote>\n<p>TODO wildcard certificate naming --> x-myapp-comain-com</p>\n</blockquote>\n<h4 id=\"1042-create-a-chained-certificate-file\"><a href=\"#1042-create-a-chained-certificate-file\" aria-label=\"1042 create a chained certificate file permalink\" class=\"autolink-a\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10.4.2. Create a chained certificate file</h4>\n<p>You get a bunch of certificate files from the Certificate Authority. You should combine them in a correct order to get a chained certificate file that contains all of them. Some examples:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">cat</span> app_mydomain_com.crt TrustedSecureCertificateAuthority5.crt USERTrustRSAAddTrustCA.crt AddTrustExternalCARoot.crt <span class=\"token operator\">></span> app_mydomain_com-chained.crt</code></pre></div>\n<p><a href=\"https://medium.com/two-cents/certificate-chain-example-e37d68c3a3f0\">https://medium.com/two-cents/certificate-chain-example-e37d68c3a3f0</a></p>\n<h4 id=\"1043-save-the-chained-certificate-file-to-kubernetes\"><a href=\"#1043-save-the-chained-certificate-file-to-kubernetes\" aria-label=\"1043 save the chained certificate file to kubernetes permalink\" class=\"autolink-a\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10.4.3. Save the chained certificate file to Kubernetes</h4>\n<p>Add <code class=\"language-text\">tls.crt:file</code> secret for the production domain name in <code class=\"language-text\">taito-config.sh</code> file.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># Custom certificate for production</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">${taito_env}</span>\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"prod\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  taito_secrets<span class=\"token operator\">=</span><span class=\"token string\">\"\n    <span class=\"token variable\">${taito_secrets}</span>\n    myapp-mydomain-com-1.tls.key:csrkey\n    myapp-mydomain-com-1.tls.crt:file\n  \"</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<p>Save the chained crt file to Kubernetes:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">taito <span class=\"token function\">env</span> rotate:prod myapp-mydomain-com-1.tls.crt</code></pre></div>\n<h4 id=\"1044-take-the-new-certificate-into-use\"><a href=\"#1044-take-the-new-certificate-into-use\" aria-label=\"1044 take the new certificate into use permalink\" class=\"autolink-a\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10.4.4. Take the new certificate into use</h4>\n<p>Define <code class=\"language-text\">myapp-mydomain-com-1</code> secret for the production domain name in <code class=\"language-text\">helm-prod.yaml</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">acme-myapp:\n  ingress:\n    domains:\n      - name: <span class=\"token variable\">${taito_domain}</span>\n        certSecret: myapp-mydomain-com-1</code></pre></div>\n<p>Either merge the change to master branch with <code class=\"language-text\">taito env merge:dev prod</code>, or deploy the configuration change directly to production:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">taito deployment deploy:prod</code></pre></div>\n<h4 id=\"1045-renew-the-certificate\"><a href=\"#1045-renew-the-certificate\" aria-label=\"1045 renew the certificate permalink\" class=\"autolink-a\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10.4.5. Renew the certificate</h4>\n<p>TODO</p>\n<h4 id=\"1046-revert-back-to-the-default-dv-certificate\"><a href=\"#1046-revert-back-to-the-default-dv-certificate\" aria-label=\"1046 revert back to the default dv certificate permalink\" class=\"autolink-a\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10.4.6. Revert back to the default DV certificate</h4>\n<p>You can revert back to the default DV certificate just by removing the <code class=\"language-text\">certSecret</code> setting for the domain from <code class=\"language-text\">helm-prod.yaml</code>.</p>\n<hr>\n<p><strong>Next:</strong> <a href=\"/tutorial/11-running-in-production\">11. Running in production</a></p>"},"menu":{"edges":[{"node":{"id":"ea55262d-3b99-5702-92bb-7b8eb6a63904","headings":[{"value":"1. Starting a new project"}],"fields":{"slug":"/tutorial/01-starting-a-new-project/"}}},{"node":{"id":"e61f9197-cbcf-59ec-a93c-16a90d35ac5e","headings":[{"value":"2. Local development"}],"fields":{"slug":"/tutorial/02-local-development/"}}},{"node":{"id":"d4baa900-2a12-54f9-ba27-a8d534508a50","headings":[{"value":"3. Version control"}],"fields":{"slug":"/tutorial/03-version-control/"}}},{"node":{"id":"e5b28f6e-dc7c-55b2-a8df-6371666edba3","headings":[{"value":"4. Project management"}],"fields":{"slug":"/tutorial/04-project-management/"}}},{"node":{"id":"410079ee-aa7c-5b73-bc4e-43fad1ad8fb2","headings":[{"value":"5. Remote environments"}],"fields":{"slug":"/tutorial/05-remote-environments/"}}},{"node":{"id":"76e02710-035a-5e3d-beb7-fc9817515f76","headings":[{"value":"6. Environment variables and secrets"}],"fields":{"slug":"/tutorial/06-env-variables-and-secrets/"}}},{"node":{"id":"1f3b8ff0-39ab-5ba1-abc4-56f7af70193c","headings":[{"value":"7. Databases and files"}],"fields":{"slug":"/tutorial/07-databases-and-files/"}}},{"node":{"id":"8fc84831-67f1-57fe-b69d-d1f62b286d84","headings":[{"value":"8. Cloud services and Terraform"}],"fields":{"slug":"/tutorial/08-cloud-services-and-terraform/"}}},{"node":{"id":"9546407a-b7a1-5085-bbe9-87528d01d1a1","headings":[{"value":"9. full-stack-template specific details"}],"fields":{"slug":"/tutorial/09-full-stack-template-specific/"}}},{"node":{"id":"89504f6e-33ec-5677-82b5-9fa28736b161","headings":[{"value":"10. Production setup"}],"fields":{"slug":"/tutorial/10-production-setup/"}}},{"node":{"id":"8fbd553c-b3fa-5b09-af2a-6a7e70bfa721","headings":[{"value":"11. Running in production"}],"fields":{"slug":"/tutorial/11-running-in-production/"}}},{"node":{"id":"55575dd6-44fc-5741-9344-880728b65709","headings":[{"value":"12. Creating a custom command"}],"fields":{"slug":"/tutorial/12-creating-a-custom-command/"}}},{"node":{"id":"696dfd23-59b7-5fca-970f-b795397bf8a6","headings":[{"value":"13. Creating a custom plugin"}],"fields":{"slug":"/tutorial/13-creating-a-custom-plugin/"}}},{"node":{"id":"91f236c1-27fe-5de2-89a2-e9836ea411e5","headings":[{"value":"14. Creating a custom template"}],"fields":{"slug":"/tutorial/14-creating-a-custom-template/"}}},{"node":{"id":"0308f442-4180-507a-a667-b0b37b2f0545","headings":[{"value":"15. Creating a zone"}],"fields":{"slug":"/tutorial/15-creating-a-zone/"}}},{"node":{"id":"d7952fc4-0209-5517-8561-16ab8989b746","headings":[{"value":"16. Zone maintenance"}],"fields":{"slug":"/tutorial/16-zone-maintenance/"}}},{"node":{"id":"f9d37f80-c89e-528c-850a-de3e2adaaf50","headings":[{"value":"17. Zone monitoring"}],"fields":{"slug":"/tutorial/17-zone-monitoring/"}}},{"node":{"id":"10521c5c-094c-5386-9051-3142ba72d172","headings":[{"value":"APPENDIX B: Software design"}],"fields":{"slug":"/tutorial/b-software-design/"}}},{"node":{"id":"0eb68f0b-802a-5e44-82c9-a5c931dae831","headings":[{"value":"APPENDIX C: Modern server infrastructure"}],"fields":{"slug":"/tutorial/c-modern-server-infrastructure/"}}},{"node":{"id":"7ad9868c-3ce5-5720-bca7-0b9140f8130c","headings":[{"value":"APPENDIX D: Security"}],"fields":{"slug":"/tutorial/d-security/"}}},{"node":{"id":"92cbd4a3-978b-56ea-9d6b-1408a3b23800","headings":[{"value":"APPENDIX E: Data protection and privacy (GDPR)"}],"fields":{"slug":"/tutorial/e-data-protection-and-privacy/"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"89504f6e-33ec-5677-82b5-9fa28736b161"}}